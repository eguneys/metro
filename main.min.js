var Space=function(){"use strict";class t{constructor(t,e,i){this.$wrap=t,this.width=e,this.height=i,this.$canvas=document.createElement("canvas"),this.$canvas.width=e,this.$canvas.height=i,t.appendChild(this.$canvas);let s=this.$canvas.getContext("webgl2",{alpha:!0,antialias:!1});null!==s&&(this.gl=s),this.$canvas.addEventListener("webglcontextlost",(t=>{console.log("context lost"),t.preventDefault(),this.gl=void 0})),this.$canvas.addEventListener("webglcontextrestored",(()=>{console.log("restored"),null!==s&&(this.gl=s)}))}}t.make=(e,i,s)=>new t(e,i,s);class e{constructor(t,e,i){this.uniformData=t,this.attributeData=e,this.program=i}}function i(t,i,n){const h=s(t,t.VERTEX_SHADER,i),a=s(t,t.FRAGMENT_SHADER,n),o=t.createProgram();t.attachShader(o,h),t.attachShader(o,a),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)||function(t,e,i,s){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(i,t.COMPILE_STATUS)||r(t,i),t.getShaderParameter(s,t.COMPILE_STATUS)||r(t,s),console.error("Iksir: Couldn't initialize shader"),""!==t.getProgramInfoLog(e)&&console.warn("Iksir: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,o,h,a);let g=function(t,e){const i={},s=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<s;r++){const s=t.getActiveAttrib(e,r);if(0===s.name.indexOf("gl_"))continue;const n={tpe:"tpe",name:s.name,size:0,location:r};i[s.name]=n}return i}(t,o),l=function(t,e){const i={},s=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<s;r++){const s=t.getActiveUniform(e,r),n={name:s.name,location:-1,index:r};i[s.name]=n}return i}(t,o);const d=Object.keys(g);for(let e=0;e<d.length;e++)g[d[e]].location=e,t.bindAttribLocation(o,e,d[e]);t.linkProgram(o),t.deleteShader(h),t.deleteShader(a);for(let e in l)l[e],l[e].location=t.getUniformLocation(o,e);return new e(l,g,o)}function s(t,e,i){const s=t.createShader(e);return t.shaderSource(s,i),t.compileShader(s),s}function r(t,e){const i=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),s=t.getShaderInfoLog(e),r=s.split("\n"),n={},h=r.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||n[t])&&(n[t]=!0,!0))),a=[""];h.forEach((t=>{i[t-1]=`%c${i[t-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const o=i.join("\n");a[0]=o,console.error(s),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}class n{constructor(t,e){this.x=t,this.y=e}get vs(){return[this.x,this.y]}addy(t){return n.make(this.x,this.y+t)}}n.make=(t,e)=>new n(t,e),n.unit=new n(1,1),n.zero=new n(0,0);class h{constructor(t,e,i,s,r,n){this.a=t,this.b=e,this.c=i,this.d=s,this.tx=r,this.ty=n,this.array_t=new Float32Array([t,e,0,i,s,0,r,n,1])}rotate(t){let e=Math.cos(t),i=Math.sin(t),s=e*this.a-i*this.b,r=i*this.a+e*this.b,n=e*this.c-i*this.d,a=i*this.c+e*this.d,o=e*this.tx-i*this.ty,g=i*this.tx+e*this.ty;return new h(s,r,n,a,o,g)}scale(t,e){let i=this.a*t,s=this.b,r=this.c,n=this.d*e,a=this.tx,o=this.ty;return new h(i,s,r,n,a,o)}translate(t,e){let i=this.a,s=this.b,r=this.c,n=this.d,a=t+this.tx,o=e+this.ty;return new h(i,s,r,n,a,o)}mVec2(t){let e=this.a,i=this.b,s=this.c,r=this.d,h=this.tx,a=this.ty,o=e*t.x+s*t.y+h,g=i*t.x+r*t.y+a;return n.make(o,g)}}h.identity=new h(1,0,0,1,0,0),h.unit=h.identity,h.projection=(t,e)=>new h(1/t*2,0,0,-1/e*2,-1,1);class a{constructor(t){this.vertices=t}get x1(){return this.vertices[0].x}get y1(){return this.vertices[0].y}get x2(){return this.vertices[2].x}get y2(){return this.vertices[2].y}get x(){return this.x1}get y(){return this.y1}get w(){return this.x2-this.x1}get h(){return this.y2-this.y1}get vertexData(){return new Float32Array(this.vertices.flatMap((t=>t.vs)))}get indices(){return new Uint16Array([0,1,2,0,2,3])}transform(t){return new a(this.vertices.map((e=>t.mVec2(e))))}}a.make=(t,e,i,s)=>new a([n.make(t,e),n.make(t+i,e),n.make(t+i,e+s),n.make(t,e+s)]),a.unit=a.make(0,0,1,1);class o{constructor(t){this.canvas=t,this.elements=[],this.quads=[],this.attributeBuffer=new Float32Array(4*o.maxElements*2),this.indexBuffer=new Uint16Array(6*o.maxElements),this.glAttributeBuffer=null,this.glIndexBuffer=null,this.draw=(t,e,i,s=0,r=1,n=1)=>{this.quads.push(t),this.elements.push(a.unit.transform(h.unit.translate(-.5,-.5).scale(t.w*r,t.h*n).translate(.5,.5).translate(-r*t.w*.5,-n*t.h*.5).rotate(s).translate(r*t.w*.5,n*t.h*.5).translate(e,i)))},this.glOnce=t=>{let{gl:e,attributeBuffer:s,indexBuffer:r}=this;if(!e)return;e.viewport(0,0,this.width,this.height),e.clearColor(0,0,0,1),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA);let n=e.createVertexArray();e.bindVertexArray(n),this.glAttributeBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.glAttributeBuffer),this.glIndexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.glIndexBuffer);let h=i(e,"precision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n\n  gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n  vTextureCoord = aTextureCoord;\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void) {\n\n  gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n");e.useProgram(h.program),e.uniformMatrix3fv(h.uniformData.projectionMatrix.location,!1,this.projectionMatrix.array_t),e.uniform1i(h.uniformData.uSampler.location,0);let a=h.attributeData.aVertexPosition.location;e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,16,0);let o=h.attributeData.aTextureCoord.location;e.enableVertexAttribArray(o),e.vertexAttribPointer(o,2,e.FLOAT,!1,16,8);let g=e.createTexture();e.bindTexture(e.TEXTURE_2D,g),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),e.bindTexture(e.TEXTURE_2D,g),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t.width,t.height,0,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)},this.flush=()=>{let{gl:t,attributeBuffer:e,indexBuffer:i}=this;if(!t)return;let s=0,r=0;this.elements.forEach(((t,n)=>{let{vertexData:h,indices:a}=t,{texture:o,fsUv:g}=this.quads[n];for(let t=0;t<h.length;t+=2)e[s++]=h[t],e[s++]=h[t+1],e[s++]=g[t],e[s++]=g[t+1];for(let t=0;t<a.length;t++)i[r++]=4*n+a[t]})),t.clear(t.COLOR_BUFFER_BIT),t.bindBuffer(t.ARRAY_BUFFER,this.glAttributeBuffer),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.glIndexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),t.drawElements(t.TRIANGLES,r,t.UNSIGNED_SHORT,0),this.elements=[],this.quads=[]},this.projectionMatrix=h.projection(this.width,this.height)}get gl(){return this.canvas.gl}get width(){return this.canvas.width}get height(){return this.canvas.height}}o.maxElements=3200,o.make=t=>new o(t);class g{constructor(t,e){this.texture=t,this._frame=e,this.tw=t.width,this.th=t.height,this.frame=e.transform(h.unit.scale(1/this.tw,1/this.th)),this.fsUv=new Float32Array([this.x0,this.y0,this.x1,this.y1,this.x2,this.y2,this.x3,this.y3])}get w(){return this._frame.w}get h(){return this._frame.h}get x0(){return this.frame.x}get y0(){return this.frame.y}get x1(){return this.frame.x2}get y1(){return this.y0}get x2(){return this.x1}get y2(){return this.frame.y2}get x3(){return this.x0}get y3(){return this.y2}}g.make=(t,e,i,s,r)=>new g(t,a.make(e,i,s,r));const l=1e3/60,d={seconds:60*l,lengths:15*l,sixth:10*l,five:5*l,three:50,one:1*l};class c{constructor(){this._btn=new Map,this.press=t=>{this._btn.has(t)&&0!==this._btn.get(t)||this._btn.set(t,d.one)},this.release=t=>{this._btn.set(t,-d.three)},this.btn=t=>this._btn.get(t)||0,this.update=(t,e)=>{for(let[e,i]of this._btn){let s=Math.sign(i);0!==i&&(i+=t,Math.sign(i)!==s&&(i=0)),this._btn.set(e,i)}};let{press:t,release:e}=this;document.addEventListener("keydown",(e=>{switch(e.key){case"ArrowUp":t("up");break;case"ArrowDown":t("down");break;case"ArrowLeft":t("left");break;case"ArrowRight":t("right");break;case"x":t("x");break;case"c":t("c");break;case"z":t("z")}})),document.addEventListener("keyup",(t=>{switch(t.key){case"ArrowUp":e("up");break;case"ArrowDown":e("down");break;case"ArrowLeft":e("left");break;case"ArrowRight":e("right");break;case"c":e("c");break;case"x":e("x");break;case"z":e("z")}}))}}function u(t,e){return{x:t,y:e}}const _={force:u(0,0),mass:1,air_friction:.1,x:0,y:0,x0:0,y0:0,vx:0,vy:0};function f(t,e,i){let{force:s,mass:r}=t,n=(a=1/r,u((h=s).x*a,h.y*a));var h,a;let{x:o,x0:g,y:l,y0:d}=t,{air_friction:c}=t,_=l-d,f=(o-g)*c*e/i+n.x*e*(e+i)/2,x=_*c*e/i+n.y*e*(e+i)/2,A=o,y=l,m=o+f,w=l+x;t.x0=A,t.y0=y,t.x=m,t.y=w,t.vx=f,t.vy=x}class x{constructor(t,e,i,s,r){this.image=t,this.f_x=e,this.f_y=i,this.f_w=s,this.f_h=r,this.quads=[0,1,2,3,4,5].map(((n,h)=>g.make(t,e+h*s,i,s,r))),this.frame=0}get quad(){return this.quads[this.frame]}draw(t,e,i,s){t.draw(this.quad,e+(s<0?this.f_w:0),i,0,s)}}function A(t,e,i){return t<e?Math.min(t+i,e):Math.max(t-i,e)}function y(t,e,i){return t+(e-t)*i}class m{constructor(t,e,i){this.width=t,this.height=e,this.cell_size=i,this.data=Array(t*e)}get(t,e){return this.data[e*this.width+t]||!1}set(t,e,i){this.data[e*this.width+t]=i}get_world(t,e){let i=Math.floor(t/this.cell_size),s=Math.floor(e/this.cell_size);return this.get(i,s)}}class w{constructor(t,e){this.body=t,this.size=e,this.x=this.desired_x,this.y=this.desired_y,this.moving_x0=this.moving_x,this.ialign_x=0,this.moving_y0=this.moving_y,this.ialign_y=0}get target_y(){let{size:t,body:e}=this;return Math.round(e.y/t)*t}get moving_y(){let{body:t,size:e}=this;return Math.abs(t.y-t.y0)>.01*e}get desired_y(){let{moving_y:t,body:e,size:i}=this;return t?e.y:(e.vy,Math.round(e.y/i)*i)}get target_x(){let{size:t,body:e}=this;return Math.round(e.x/t)*t}get moving_x(){let{body:t,size:e}=this;return Math.abs(t.x-t.x0)>.01*e}get desired_x(){let{moving_x:t,body:e,size:i}=this;return t?e.x:(e.vx,Math.round(e.x/i)*i)}force_smooth_y(){this.ialign_y=d.five}update(t,e){0===this.ialign_x&&(this.moving_x0===this.moving_x?this.x=this.desired_x:this.ialign_x=d.five),this.ialign_x>0&&(this.x=y(this.x,this.desired_x,1-this.ialign_x/d.five)),this.ialign_x=A(this.ialign_x,0,t),this.moving_x0=this.moving_x,0===this.ialign_y&&(this.moving_y0===this.moving_y?this.y=this.desired_y:this.ialign_y=d.five),this.ialign_y>0&&(this.y=y(this.y,this.desired_y,1-this.ialign_y/d.five)),this.ialign_y=A(this.ialign_y,0,t),this.moving_y0=this.moving_y}}class b{constructor(t,e,i,s){this.grid=t,this.body=e,this.ox=i,this.oy=s}get size(){return 4*this.grid.cell_size}get x(){return Math.floor(this.body.x+this.ox)}get y(){return Math.floor(this.body.y+this.oy)}get right_extend(){let{x:t,y:e,size:i}=this;for(let s=1;s<i;s++){if(this.grid.get_world(t+s,e))return s}return i}get right_regress(){let{x:t,y:e,size:i}=this;for(let s=1;s<i;s++){if(!this.grid.get_world(t-s,e))return 1-s}return-i}get right(){let{x:t,y:e}=this;return this.grid.get_world(t,e)?this.right_regress:this.right_extend}get down_extend(){let{x:t,y:e,size:i}=this;for(let s=1;s<i;s++){if(this.grid.get_world(t,e+s))return s}return i}get down_regress(){let{x:t,y:e,size:i}=this;for(let s=1;s<i;s++){if(!this.grid.get_world(t,e-s))return 1-s}return-i}get down(){let{x:t,y:e}=this;return this.grid.get_world(t,e)?this.down_regress:this.down_extend}}class p extends class{constructor(t){this.ctx=t,this.q_dark=g.make(this.a,0,0,1,1),this.q_red=g.make(this.a,4,0,1,1),this.q_tile=g.make(this.a,0,16,4,4),this.q_player=g.make(this.a,16,16,12,20),this.init()}get play(){return this.ctx.play}get a(){return this.ctx.image}get input(){return this.ctx.input}}{constructor(){super(...arguments),this.t_jump=0}get sensor_f(){return this.facing_x<0?this.sensor_h:this.sensor_l}get sensor_fo(){return this.facing_x<0?this.sensor_ho:this.sensor_lo}get sensor_b(){return this.facing_x<0?this.sensor_l:this.sensor_h}get sensor_bo(){return this.facing_x<0?this.sensor_lo:this.sensor_ho}init(){this.anim=new x(this.a,0,48,12,20),this.elapsed=0,this.gravity=u(0,.001),this.grid=new m(320,180,4);for(let t=0;t<80;t++)this.grid.set(t,41,!0),this.grid.set(t+40,40,!0),this.grid.set(t+42,39,!0),this.grid.set(t+44,38,!0),this.grid.set(t+60,30,!0),this.grid.set(t+60,29,!0),this.grid.set(t+66,28,!0),this.grid.set(t+66,27,!0),this.grid.set(t+66,26,!0),t<10&&(this.grid.set(t,38,!0),this.grid.set(t+2,39,!0),this.grid.set(t+4,40,!0),this.grid.set(54,31+t,!0),this.grid.set(t+54,31,!0));for(let t=0;t<4;t++)this.grid.set(6+t,30,!0);this.body=function(t,e){for(let i in t)e[i]||(e[i]=t[i]);return e}(_,{y0:120,y:120,air_friction:.8}),this.align=new w(this.body,4),this.sensor=new b(this.grid,this.body,6,20),this.sensor_l=new b(this.grid,this.align,9,20),this.sensor_lo=new b(this.grid,this.align,12,20),this.sensor_h=new b(this.grid,this.align,3,20),this.sensor_ho=new b(this.grid,this.align,0,20),this.sensor_right=new b(this.grid,this.align,12,10)}update(t,e){this.elapsed+=t;let{body:i,align:s,gravity:r}=this,n=0;0!==this.input.btn("right")?(n=1,this.facing_x=1):0!==this.input.btn("left")&&(n=-1,this.facing_x=-1);let h=0;0!==this.input.btn("c")&&(h=1),0===this.sensor.down&&0===this.t_jump&&h>0&&(this.t_jump=d.lengths),this.t_jump>0&&(i.force.y-=.02*h*(this.t_jump/d.lengths)*(1-this.t_jump/d.lengths)),this.t_jump=A(this.t_jump,0,t),(this.sensor_right.right>0||n<0)&&(i.force.x+=.001*n),this.sensor.down>0&&(i.force.x+=r.x,i.vy>0?i.force.y+=3*r.y:i.force.y+=r.y),f(i,t,e),i.force.x=0,i.force.y=0,this.sensor_right.right<0&&(i.x+=this.sensor_right.right,i.x0=i.x),this.sensor.down<0&&(i.y+=this.sensor.down,i.y0=i.y,this.align.force_smooth_y()),this.align.update(t,e);let{sensor_f:a,sensor_fo:o,sensor_bo:g,sensor_b:l}=this;a.down>0&&0===g.down?this.anim.frame=3:0===a.down&&g.down<0||a.down>0&&g.down<0?this.anim.frame=4:a.down<0&&o.down<0?this.anim.frame=2:g.down>0?this.anim.frame=1:this.anim.frame=0}draw(){this.play.draw(this.q_dark,0,80,0,10,2);for(let t=0;t<this.grid.height;t++)for(let e=0;e<this.grid.width;e++){this.grid.get(e,t)&&this.play.draw(this.q_tile,4*e,4*t,0,1,1)}let{x:t,y:e}=this.align;this.anim.draw(this.play,t,e,this.facing_x);let{down:i}=this.sensor;i<0?this.play.draw(this.q_red,this.sensor.x,this.sensor.y+i,0,1,-i):this.play.draw(this.q_red,this.sensor.x,this.sensor.y-2,0,1,i+2);let{right:s}=this.sensor_right;s<0?this.play.draw(this.q_red,this.sensor_right.x+s,this.sensor_right.y,0,-s,1):this.play.draw(this.q_red,this.sensor_right.x-2,this.sensor_right.y,0,s+2,1)}}return function(e){let i=new c,s=function(e,i=320,s=180){let r=t.make(e,i,s);return o.make(r)}(e);var r;(r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAAXNSR0IArs4c6QAAACRQTFRFAAAAACAzIycxPEpUTbDIY8SNaQpAcH6Ac93ces5KtLy3////88XElAAAAAF0Uk5TAEDm2GYAAAEpSURBVHic7dYxagJBAIbRwSkC6bxB0AtIplhIbZfaK6QObDHgCbyCXcAiMHW6XC6jo+YEzgq+B64DFv8nu6BhPt/vPz52uzAVAZMHAMBm095/f9br998JA+p+LXjkgPXJBAEXAgQIECBAwOQBk/0c303AZH/JAADgziwW/+fZ4qXndJs7BZyHuwXMXv7nlulSEWJ67RTQ9lpASilfA9Kqa8DyGBDDkGtFPT3l2CvgtBfaXFzlbUixHnMOsU9AXMU2nU4ZubSAUmpal4B0DVgdA46vy1evz8PtPY116DOEYRzqNQ7HUxzbZ0OPgDy2oTzWux5i/qx3/zJcn4fbK4d2v8thW6/P5SuU77dyDigdAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeHh/JnBbG7ueWwcAAAAASUVORK5CYII=",new Promise((t=>{let e=new Image;e.onload=()=>t(e),e.src=r}))).then((t=>{s.glOnce(t);let e=new p({input:i,play:s,image:t}),r=1e3/60,n=r,h=0;requestAnimationFrame((function t(a){let o=r;o=Math.max(16.666666666666668,o),o=Math.min(33.333333333333336,o),i.update(o,n),i.btn("z")>0&&e.init(),i.btn("x")>0?h++%24==0&&e.update(o,n):e.update(o,n),e.draw(),s.flush(),n=o,requestAnimationFrame(t)}))}))}}();
